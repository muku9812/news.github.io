{"version":3,"sources":["webpack:///external \"React\"","webpack:///external \"ReactDOM\"","webpack:///external \"jQuery\"","webpack:///./src/admin/integrations/divi/modules/PrestoPlayer/RenderPlayer.jsx","webpack:///./src/admin/integrations/divi/modules/util.js","webpack:///./src/admin/integrations/divi/modules/PrestoPlayer/PrestoPlayer.jsx","webpack:///./src/admin/integrations/divi/modules/index.js","webpack:///./src/admin/integrations/divi/fields/VideoSelector/VideoSelector.jsx","webpack:///./src/admin/integrations/divi/fields/index.js","webpack:///./src/admin/integrations/divi/index.js"],"names":["module","exports","React","ReactDOM","jQuery","id","src","useState","data","setData","loading","setLoading","provider","setProvider","renderKey","setRenderKey","useEffect","getHtml","match","indexOf","getProvider","a","fetch","method","credentials","headers","body","URLSearchParams","action","_wpnonce","window","et_fb_options","et_admin_load_nonce","then","response","json","res","className","key","video_id","preset","chapters","tracks","branding","blockAttributes","config","skin","analytics","automations","provider_video_id","youtube","full","type","target","href","__","wp","i18n","PrestoPlayer","props","state","videos","url_override","this","dynamic","RenderPlayer","value","Component","PrestoNonceProvider","nonce","createCache","container","memoizeOne","createEmotionCacheCustom","NonceProvider","VideoSelector","input","search","post_id","searchTerm","postId","Promise","all","fetchVideo","fetchVideos","video","find","item","ID","push","map","label","post_title","setState","event","_onChange","name","open","focus","parseInt","debouncedLoadVideos","debounce","inputValue","loadVideos","leading","parent","document","cacheOptions","defaultOptions","currentVideoLabel","onChange","loadOptions","onClick","_onEditVideoClick","_onCreateVideoClick","$","on","API","registerModules","modules","registerModalFields","fields"],"mappings":"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","file":"divi/admin-1a1a82cb.js","sourcesContent":["module.exports = React;","module.exports = ReactDOM;","module.exports = jQuery;","import { PrestoPlayer } from \"@presto-player/react\";\nimport React, { useEffect, useState } from \"react\";\nimport { getProvider } from \"../util\";\n\nexport default ({ id, src }) => {\n  const [data, setData] = useState({});\n  const [loading, setLoading] = useState(false);\n  const [provider, setProvider] = useState(\"self-hosted\");\n  const [renderKey, setRenderKey] = useState(1);\n\n  useEffect(() => {\n    setRenderKey(renderKey + 1);\n  }, [id, src, data]);\n\n  useEffect(() => {\n    getHtml(id);\n  }, [id]);\n\n  useEffect(() => {\n    setProvider(getProvider(src));\n  }, [src]);\n\n  const getHtml = async (id) => {\n    if (!id) {\n      return;\n    }\n    setLoading(true);\n    try {\n      const res = await fetch(`/wp-admin/admin-ajax.php`, {\n        method: \"POST\",\n        credentials: \"same-origin\",\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n          \"Cache-Control\": \"no-cache\",\n        },\n        body: new URLSearchParams({\n          action: \"presto_get_media_attributes\",\n          _wpnonce: window.et_fb_options.et_admin_load_nonce,\n          id,\n        }),\n      }).then((response) => response.json());\n      setData(res.data);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"et-fb-preloader et-fb-preloader__loading\">\n        <div className=\"et-fb-loader\" />\n      </div>\n    );\n  }\n\n  if (data.id) {\n    src = src ? src : data.src;\n\n    if (\n      data?.provider === \"bunny\" &&\n      (provider === \"self-hosted\" || provider === \"bunny\")\n    ) {\n      return (\n        <presto-video-curtain-ui>\n          <span>\n            Bunny.net videos cannot be previewed in the DIVI editor due to DIVI\n            iframe having no referrer.\n          </span>\n          <presto-player-button\n            full\n            type=\"primary\"\n            target=\"_blank\"\n            href=\"https://prestoplayer.com/docs/bunny-net-videos-not-showing-in-divi-editor\"\n          >\n            Learn More\n          </presto-player-button>\n        </presto-video-curtain-ui>\n      );\n    }\n\n    return (\n      <PrestoPlayer\n        key={renderKey}\n        video_id={data.id}\n        preset={data.preset}\n        src={src}\n        chapters={data.chapters}\n        tracks={data.tracks}\n        branding={data.branding}\n        blockAttributes={data.blockAttributes}\n        config={data.config}\n        skin={data.skin}\n        analytics={data.analytics}\n        automations={data.automations}\n        provider={provider}\n        provider_video_id={data.provider_video_id}\n        youtube={data.youtube}\n      ></PrestoPlayer>\n    );\n  } else {\n    return \"Choose A Video\";\n  }\n};\n","export function getProvider(src) {\n  const provider = \"self-hosted\";\n\n  if (src) {\n    const yt_rx =\n      /^(?:https?:\\/\\/)?(?:www\\.)?(?:youtu\\.be\\/|youtube\\.com\\/(?:embed\\/|v\\/|watch\\?v=|watch\\?.+&v=))((\\w|-){11})(?:\\S+)?$/;\n    const has_match_youtube = src.match(yt_rx);\n\n    if (has_match_youtube) {\n      return \"youtube\";\n    }\n\n    const vm_rx =\n      /(https?:\\/\\/)?(www\\.)?(player\\.)?vimeo\\.com\\/([a-z]*\\/)*([‌​0-9]{6,11})[?]?.*/;\n    const has_match_vimeo = src.match(vm_rx);\n\n    if (has_match_vimeo) {\n      return \"vimeo\";\n    }\n\n    if (src.indexOf(\"https://vz-\") > -1 && src.indexOf(\"b-cdn.net\") > -1) {\n      return \"bunny\";\n    }\n  }\n  return provider;\n}\n","// External Dependencies\nimport React, { Component } from \"react\";\nimport RenderPlayer from \"./RenderPlayer\";\n// Internal Dependencies\nimport \"./style.css\";\n\nconst { __ } = wp.i18n;\n\nclass PrestoPlayer extends Component {\n  static slug = \"prpl_presto_player\";\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      videos: [],\n    };\n  }\n\n  render() {\n    const url_override = this.props.dynamic.url_override; // https://gist.github.com/lots0logs/9b6bb0b3d494f4d0bdf957955d97cb26\n\n    if (this.props.video_id) {\n      return (\n        <RenderPlayer\n          id={this.props.video_id}\n          src={url_override && url_override.value && url_override.value}\n        />\n      );\n    } else {\n      return (\n        <presto-video-curtain-ui>\n          <span>{__(\"Please select a video.\", \"presto-player\")}</span>\n        </presto-video-curtain-ui>\n      );\n    }\n  }\n}\n\nexport default PrestoPlayer;\n","import PrestoPlayer from './PrestoPlayer/PrestoPlayer';\n\nexport default [PrestoPlayer];\n","// External Dependencies\nimport createCache from \"@emotion/cache\";\nimport memoizeOne from \"memoize-one\";\nimport React, { Component } from \"react\";\nimport { NonceProvider } from \"react-select\";\nimport AsyncSelect from \"react-select/async\";\nimport debounce from \"debounce-promise\";\nconst { __ } = wp.i18n;\n\n// Internal Dependencies\nimport \"./style.css\";\n\nclass PrestoNonceProvider extends NonceProvider {\n  createEmotionCacheCustom = function (nonce) {\n    return createCache({\n      nonce,\n      key: \"custom-select-style\",\n      container: this.props.container,\n    });\n  };\n\n  createEmotionCache = memoizeOne(this.createEmotionCacheCustom);\n}\n\nclass VideoSelector extends Component {\n  static slug = \"prpl_video_selector\";\n\n  constructor(props) {\n    super(props);\n    this.state = { videos: [] };\n\n    const wait = 500; // milliseconds\n    const loadVideos = (inputValue) =>\n      this.loadVideos({ searchTerm: inputValue });\n    this.debouncedLoadVideos = debounce(loadVideos, wait, {\n      leading: true,\n    });\n  }\n\n  /**\n   * Search for videos\n   *\n   * @param {string} input\n   * @returns {array}\n   */\n  fetchVideos = (input = \"\") => {\n    return fetch(`/wp-admin/admin-ajax.php`, {\n      method: \"POST\",\n      credentials: \"same-origin\",\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n        \"Cache-Control\": \"no-cache\",\n      },\n      body: new URLSearchParams({\n        action: \"presto_fetch_videos\",\n        search: input,\n      }),\n    })\n      .then((response) => response.json())\n      .then((response) => response.data || []);\n  };\n\n  /**\n   * Fetch a specific video\n   * @param {array} input\n   * @returns {array}\n   */\n  fetchVideo = (input = \"\") => {\n    if (!input) {\n      return [];\n    }\n\n    return fetch(`/wp-admin/admin-ajax.php`, {\n      method: \"POST\",\n      credentials: \"same-origin\",\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n        \"Cache-Control\": \"no-cache\",\n      },\n      body: new URLSearchParams({\n        action: \"presto_fetch_videos\",\n        post_id: input,\n      }),\n    })\n      .then((response) => response.json())\n      .then((response) => response.data || []);\n  };\n\n  /**\n   * Load the videos from the db\n   * @param {string} input\n   * @returns\n   */\n  loadVideos = async (input) => {\n    input = {\n      searchTerm: \"\",\n      postId: \"\",\n      ...input,\n    };\n\n    let [video, videos] = await Promise.all([\n      this.fetchVideo(input.postId),\n      this.fetchVideos(input.searchTerm),\n    ]);\n\n    if (video[0] && !videos.find((item) => item.ID === video[0].ID)) {\n      videos.push(video[0]);\n    }\n    videos = videos.map((item) => {\n      return {\n        label: item.post_title || __(\"Untitled\", \"presto-player\"),\n        value: item.ID,\n      };\n    });\n\n    this.setState({ videos });\n\n    return videos;\n  };\n\n  /**\n   * Handle input value change.\n   *\n   * @param {object} event\n   */\n  _onChange = (event) => {\n    this.props._onChange(this.props.name, event.value);\n  };\n\n  /**\n   * Handle edit video click.\n   * @returns null\n   */\n  _onEditVideoClick = () => {\n    var video_id = this.props.value;\n    if (!video_id) {\n      return;\n    }\n    var win = window.open(\n      `/wp-admin/post.php?post=${video_id}&action=edit`,\n      \"_blank\"\n    );\n    win.focus();\n  };\n\n  /**\n   * Handle create video click.\n   */\n  _onCreateVideoClick = () => {\n    var win = window.open(\n      `/wp-admin/post-new.php?post_type=pp_video_block`,\n      \"_blank\"\n    );\n    win.focus();\n  };\n\n  /**\n   * Determine the video label\n   * @returns {string}\n   */\n  currentVideoLabel = () => {\n    if (!this.state.videos) {\n      return \"\";\n    }\n\n    const video = (this.state.videos || []).find((video) => {\n      return video.value === parseInt(this.props.value);\n    });\n\n    if (!video) {\n      return \"\";\n    }\n\n    return video.label;\n  };\n\n  /**\n   * Render the component\n   * @returns {JSX}\n   */\n  render() {\n    return (\n      <div className=\"presto-player-divi-editor\">\n        <ul className=\"presto-player-divi-editor__inputs\">\n          <li>\n            <PrestoNonceProvider container={window.parent.document.body}>\n              <AsyncSelect\n                id={`prpd_video_selector-${this.props.name}`}\n                className=\"prpd_video_selector\"\n                cacheOptions\n                defaultOptions\n                name={this.props.name}\n                value={{\n                  value: this.props.value,\n                  label: this.currentVideoLabel(),\n                }}\n                onChange={this._onChange}\n                loadOptions={(inputValue) =>\n                  this.debouncedLoadVideos(inputValue)\n                }\n              />\n            </PrestoNonceProvider>\n          </li>\n          <li>\n            <label>{__(\"Video Options\", \"presto-player\")}</label>\n            <button type=\"button\" onClick={this._onEditVideoClick}>\n              {__(\"Edit Video\", \"presto-player\")}\n            </button>\n          </li>\n          <li>\n            <label>{__(\"New Video\", \"presto-player\")}</label>\n            <button type=\"button\" onClick={this._onCreateVideoClick}>\n              {__(\"Create Video\", \"presto-player\")}\n            </button>\n          </li>\n        </ul>\n      </div>\n    );\n  }\n}\n\nexport default VideoSelector;\n","import VideoSelector from './VideoSelector/VideoSelector';\n\nexport default [VideoSelector];\n","// External Dependencies\nimport $ from \"jquery\";\n\n// Internal Dependencies\nimport modules from \"./modules\";\nimport fields from \"./fields\";\n\n$(window).on(\"et_builder_api_ready\", (event, API) => {\n  API.registerModules(modules);\n  API.registerModalFields(fields);\n});\n"],"sourceRoot":""}